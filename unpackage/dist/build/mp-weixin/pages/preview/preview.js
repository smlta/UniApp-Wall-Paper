"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/system.js"),l=require("../../API/api.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-rate")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o={__name:"preview",setup(o){const u=e.ref(null),t=e.ref(null),n=e.ref([]),s=e.ref([]),i=e.ref([]),c=e.ref(null),v=e.ref(!1);n.value=e.index.getStorageSync("cate_wall")||[],s.value=n.value.map((e=>({...e,smallPicurl:e.smallPicurl.replace("_small.webp",".jpg")})));const r=e=>{t.value=e.detail.current,d(),c.value=s.value[t.value]};e.onLoad((e=>{u.value=e.id,t.value=s.value.findIndex((e=>e._id===u.value)),c.value=s.value[t.value],d()}));const d=()=>{i.value.push(t.value<=0?s.value.length-1:t.value-1,t.value,t.value>=s.value.length-1?0:t.value+1),i.value=[...new Set(i.value)]},p=e.ref(!0),m=e.ref(null),f=e.ref(null),h=e.ref(0),g=()=>{p.value=!p.value},w=()=>{m.value.open()},x=()=>{m.value.close()},_=()=>{c.value.useScore&&(v.value=!0,h.value=c.value.useScore),f.value.open()},b=()=>{f.value.close(),h.value=0,v.value=!1},y=async()=>{e.index.showLoading({title:"加载中..."});let{classid:a,_id:o}=c.value;const u=await l.setWallScore({classid:a,wallId:o,userScore:h.value});e.index.hideLoading(),0===u.data.errCode&&(e.index.showToast({title:"评分成功",icon:"none"}),s.value[t.value].useScore=h.value,e.index.setStorageSync("cate_wall",s.value),b())},S=()=>{e.index.showLoading({title:"下载中",mask:!0}),e.index.getImageInfo({src:c.value.smallPicurl,success:a=>{e.index.saveImageToPhotosAlbum({filePath:a.path,success:e=>{console.log(e)},fail:a=>{"saveImageToPhotosAlbum:fail auth cancel"!==a.errMsg?e.index.showModal({title:"提示",content:"需要授权重新授权以保存图片",success:a=>{e.index.openSetting({success:a=>{a.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"获取授权成功!",icon:"none"}):e.index.showToast({title:"获取授权失败",icon:"none"})}})}}):e.index.showToast({title:"保存失败,请重新点击下载",icon:"none"})},complete:()=>{e.index.hideLoading()}})}})};return(l,o)=>e.e({a:e.f(s.value,((a,l,o)=>e.e({a:i.value.includes(l)},i.value.includes(l)?{b:a.smallPicurl,c:e.o(g,a._id)}:{},{d:a._id}))),b:t.value,c:e.o(r),d:p.value},p.value?{e:e.p({type:"back",color:"#fff",size:"20"}),f:e.unref(a.getStatusBarHeight)()+"px",g:e.o((a=>{e.index.navigateBack()})),h:e.t(t.value+1),i:e.t(s.value.length),j:e.p({date:new Date,format:"hh:mm"}),k:e.p({date:new Date,format:"MM月dd日"}),l:e.p({type:"info",size:"28"}),m:e.o(w),n:e.p({type:"info",size:"28"}),o:e.o(_),p:e.p({type:"info",size:"28"}),q:e.o(S),r:e.p({type:"closeempty",size:"18",color:"#999"}),s:e.o(x),t:e.t(c.value.classid),v:e.t(c.value.nickname),w:e.p({readonly:!0,touchable:!0,value:c.value.score}),x:e.t(c.value.score),y:e.t(c.value.description),z:e.f(c.value.tabs,((a,l,o)=>({a:e.t(a),b:a}))),A:e.sr(m,"7b3e3527-6",{k:"pop"}),B:e.p({type:"bottom"}),C:e.t(v.value?"您已经评过分了":"壁纸评分"),D:e.p({type:"closeempty",size:"18",color:"#999"}),E:e.o(b),F:e.o((e=>h.value=e)),G:e.p({"allow-half":!0,disabled:v.value,"disabled-color":"#FFCA3E",modelValue:h.value}),H:e.t(h.value),I:!h.value||v.value,J:e.o(y),K:e.sr(f,"7b3e3527-9",{k:"ratepop"})}:{})}},u=e._export_sfc(o,[["__scopeId","data-v-7b3e3527"]]);wx.createPage(u);
